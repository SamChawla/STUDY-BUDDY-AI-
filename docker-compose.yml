version: '3.8'
services:
  # 1. Your Application Service (Study Buddy)
  study-buddy-app:
    image: samchawla/studybuddy:latest # Your Docker Hub image
    container_name: study-buddy-container
    restart: always
    # Expose the application's internal port (e.g., 8000) only to the internal network
    expose:
      - 8000
    
  # 2. The Nginx Reverse Proxy Service
  nginx-proxy:
    image: nginx:stable-alpine # Use a stable, lightweight Nginx image
    container_name: nginx-proxy-container
    restart: always
    ports:
      # Map the VM's public port 80 to the container's port 80
      - "80:80"
    volumes:
      # Mount your custom Nginx configuration file into the container
      - ./nginx.conf:/etc/nginx/conf.d/default.conf
    # Nginx must wait for the application to be running
    depends_on:
      - study-buddy-app